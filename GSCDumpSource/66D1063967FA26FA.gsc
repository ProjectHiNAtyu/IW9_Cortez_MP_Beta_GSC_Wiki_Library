// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level.outlineids = 0;
    level.outlineents = [];
    level.outlineidspending = [];
    scripts\mp\utility\disconnect_event_aggregator::registerondisconnecteventcallback( ::outlineonplayerdisconnect );
    scripts\mp\utility\join_team_aggregator::registeronplayerjointeamcallback( ::outlineonplayerjoinedteam );
    _id_2342B8AAD723994E::registeronplayerjoinsquadcallback( ::outlineonplayerjoinedsquad );
    level thread outlineidswatchpending();
}

outlineenableinternal( _id_F20913FEC7561C5F, playersvisibleto, hudoutlineassetname, _id_F4690AF2813396A3, type, _id_00FA3B23D51C2DC7, squadindex )
{
    if ( !isdefined( _id_F20913FEC7561C5F.outlines ) )
        _id_F20913FEC7561C5F.outlines = [];

    _id_E1CECB04682E8442 = spawnstruct();
    _id_E1CECB04682E8442.isdisabled = 0;
    _id_E1CECB04682E8442.priority = _id_F4690AF2813396A3;
    _id_E1CECB04682E8442.playersvisibleto = playersvisibleto;
    _id_E1CECB04682E8442.playersvisibletopending = [];
    _id_E1CECB04682E8442.hudoutlineassetname = hudoutlineassetname;
    _id_E1CECB04682E8442.type = type;
    _id_E1CECB04682E8442.team = _id_00FA3B23D51C2DC7;
    _id_E1CECB04682E8442._id_0FF97225579DE16A = squadindex;
    id = outlinegenerateuniqueid();
    _id_F20913FEC7561C5F.outlines[id] = _id_E1CECB04682E8442;
    outlineaddtogloballist( _id_F20913FEC7561C5F );
    _id_CDA6602A02C53BA3 = [];

    foreach ( player in _id_E1CECB04682E8442.playersvisibleto )
    {
        if ( !canoutlineforplayer( player ) )
        {
            _id_E1CECB04682E8442.playersvisibletopending[_id_E1CECB04682E8442.playersvisibletopending.size] = player;
            level.outlineidspending[id] = _id_F20913FEC7561C5F;
            continue;
        }

        _id_25A840A406E8542A = outlinegethighestinfoforplayer( _id_F20913FEC7561C5F, player );

        if ( !isdefined( _id_25A840A406E8542A ) || _id_25A840A406E8542A == _id_E1CECB04682E8442 || _id_25A840A406E8542A.priority == _id_E1CECB04682E8442.priority )
            _id_CDA6602A02C53BA3[_id_CDA6602A02C53BA3.size] = player;
    }

    if ( _id_CDA6602A02C53BA3.size > 0 )
        _id_F20913FEC7561C5F _hudoutlineenableforclients( _id_CDA6602A02C53BA3, _id_E1CECB04682E8442.hudoutlineassetname );

    return id;
}

outlinedisableinternal( id, _id_420A996E67989DC4 )
{
    if ( !isdefined( _id_420A996E67989DC4 ) )
    {
        level.outlineents = scripts\engine\utility::array_removeundefined( level.outlineents );
        return;
    }
    else if ( !isdefined( _id_420A996E67989DC4.outlines ) )
    {
        outlineremovefromgloballist( _id_420A996E67989DC4 );
        return;
    }

    _id_77C349ECEF6FB0D9 = _id_420A996E67989DC4.outlines[id];

    if ( !isdefined( _id_77C349ECEF6FB0D9 ) || _id_77C349ECEF6FB0D9.isdisabled )
        return;

    _id_77C349ECEF6FB0D9.isdisabled = 1;

    foreach ( player in _id_77C349ECEF6FB0D9.playersvisibleto )
    {
        if ( !isdefined( player ) )
            continue;

        if ( !canoutlineforplayer( player ) )
        {
            _id_77C349ECEF6FB0D9.playersvisibletopending[_id_77C349ECEF6FB0D9.playersvisibletopending.size] = player;
            level.outlineidspending[id] = _id_420A996E67989DC4;
            continue;
        }

        _id_25A840A406E8542A = outlinegethighestinfoforplayer( _id_420A996E67989DC4, player );

        if ( isdefined( _id_25A840A406E8542A ) )
        {
            if ( _id_25A840A406E8542A.priority <= _id_77C349ECEF6FB0D9.priority )
                _id_420A996E67989DC4 _hudoutlineenableforclient( player, _id_25A840A406E8542A.hudoutlineassetname );

            continue;
        }

        _id_420A996E67989DC4 hudoutlinedisableforclient( player );
    }

    if ( _id_77C349ECEF6FB0D9.playersvisibletopending.size == 0 )
    {
        _id_420A996E67989DC4.outlines[id] = undefined;

        if ( _id_420A996E67989DC4.outlines.size == 0 )
            outlineremovefromgloballist( _id_420A996E67989DC4 );
    }
}

outlinerefreshinternal( _id_420A996E67989DC4 )
{
    if ( !isdefined( _id_420A996E67989DC4.outlines ) || _id_420A996E67989DC4.outlines.size == 0 )
        return;

    foreach ( _id_5454630434983DD7, _id_E1CECB04682E8442 in _id_420A996E67989DC4.outlines )
    {
        if ( !isdefined( _id_E1CECB04682E8442 ) || _id_E1CECB04682E8442.isdisabled )
            continue;

        foreach ( player in _id_E1CECB04682E8442.playersvisibleto )
        {
            if ( !isdefined( player ) )
                continue;

            _id_25A840A406E8542A = outlinegethighestinfoforplayer( _id_420A996E67989DC4, player );

            if ( isdefined( _id_25A840A406E8542A ) )
                _id_420A996E67989DC4 _hudoutlineenableforclient( player, _id_25A840A406E8542A.hudoutlineassetname );
        }
    }
}

outlineonplayerdisconnect( player )
{
    outlineremoveplayerfromvisibletoarrays( player );
    outlinedisableinternalall( player );
}

outlineonplayerjoinedteam( player )
{
    if ( !isdefined( player.team ) || player.team == "spectator" || player.team == "codcaster" )
        return;

    thread outlineonplayerjoinedteam_onfirstspawn( player );
}

outlineonplayerjoinedteam_onfirstspawn( player )
{
    player notify( "outlineOnPlayerJoinedTeam_onFirstSpawn" );
    player endon( "outlineOnPlayerJoinedTeam_onFirstSpawn" );
    player endon( "disconnect" );
    player waittill( "spawned_player" );
    outlineremoveplayerfromvisibletoarrays( player );
    outlinedisableinternalall( player );
    outlineaddplayertoexistingallandteamoutlines( player );
}

outlineonplayerjoinedsquad( player )
{
    thread outlineonplayerjoinedsquad_onfirstspawn( player );
}

outlineonplayerjoinedsquad_onfirstspawn( player )
{
    player notify( "outlineOnPlayerJoinedSquad_onFirstSpawn" );
    player endon( "outlineOnPlayerJoinedSquad_onFirstSpawn" );
    player endon( "disconnect" );
    player waittill( "spawned_player" );
    outlineremoveplayerfromvisibletoarrays( player, 1 );
    outlineaddplayertoexistingsquadoutlines( player );
}

outlineremoveplayerfromvisibletoarrays( player, _id_E1F59B5642DA1702 )
{
    level.outlineents = scripts\engine\utility::array_removeundefined( level.outlineents );

    foreach ( _id_420A996E67989DC4 in level.outlineents )
    {
        _id_8408CBA753ABA3E3 = 0;

        if ( !isdefined( _id_420A996E67989DC4 ) || !isdefined( _id_420A996E67989DC4.outlines ) )
            continue;

        foreach ( _id_E1CECB04682E8442 in _id_420A996E67989DC4.outlines )
        {
            if ( !isdefined( _id_E1CECB04682E8442.playersvisibleto ) )
                continue;

            if ( istrue( _id_E1F59B5642DA1702 ) )
            {
                if ( _id_E1CECB04682E8442.type != "SQUAD" )
                    continue;
            }

            _id_E1CECB04682E8442.playersvisibleto = scripts\engine\utility::array_removeundefined( _id_E1CECB04682E8442.playersvisibleto );

            if ( isdefined( player ) && scripts\engine\utility::array_contains( _id_E1CECB04682E8442.playersvisibleto, player ) )
            {
                _id_E1CECB04682E8442.playersvisibleto = scripts\engine\utility::array_remove( _id_E1CECB04682E8442.playersvisibleto, player );
                _id_8408CBA753ABA3E3 = 1;
            }
        }

        if ( _id_8408CBA753ABA3E3 && isdefined( _id_420A996E67989DC4 ) && isdefined( player ) )
            _id_420A996E67989DC4 hudoutlinedisableforclient( player );
    }
}

outlineaddplayertoexistingallandteamoutlines( player )
{
    foreach ( _id_420A996E67989DC4 in level.outlineents )
    {
        if ( !isdefined( _id_420A996E67989DC4 ) || !isdefined( _id_420A996E67989DC4.outlines ) )
            continue;

        _id_25A840A406E8542A = undefined;

        foreach ( _id_E1CECB04682E8442 in _id_420A996E67989DC4.outlines )
        {
            if ( _id_E1CECB04682E8442.type == "ALL" || _id_E1CECB04682E8442.type == "TEAM" && _id_E1CECB04682E8442.team == player.team )
            {
                if ( !scripts\engine\utility::array_contains( _id_E1CECB04682E8442.playersvisibleto, player ) )
                    _id_E1CECB04682E8442.playersvisibleto[_id_E1CECB04682E8442.playersvisibleto.size] = player;
                else
                {

                }

                if ( !isdefined( _id_25A840A406E8542A ) || _id_E1CECB04682E8442.priority > _id_25A840A406E8542A.priority )
                    _id_25A840A406E8542A = _id_E1CECB04682E8442;
            }
        }

        if ( isdefined( _id_25A840A406E8542A ) )
            _id_420A996E67989DC4 _hudoutlineenableforclient( player, _id_25A840A406E8542A.hudoutlineassetname );
    }
}

outlineaddplayertoexistingsquadoutlines( player )
{
    if ( !isdefined( player._id_0FF97225579DE16A ) )
    {

    }

    foreach ( _id_420A996E67989DC4 in level.outlineents )
    {
        if ( !isdefined( _id_420A996E67989DC4 ) || !isdefined( _id_420A996E67989DC4.outlines ) )
            continue;

        _id_25A840A406E8542A = undefined;

        foreach ( _id_E1CECB04682E8442 in _id_420A996E67989DC4.outlines )
        {
            if ( _id_E1CECB04682E8442.type == "SQUAD" && _id_E1CECB04682E8442.team == player.team && isdefined( _id_E1CECB04682E8442._id_0FF97225579DE16A ) && _id_E1CECB04682E8442._id_0FF97225579DE16A == player._id_0FF97225579DE16A )
            {
                if ( !scripts\engine\utility::array_contains( _id_E1CECB04682E8442.playersvisibleto, player ) )
                    _id_E1CECB04682E8442.playersvisibleto[_id_E1CECB04682E8442.playersvisibleto.size] = player;
                else
                {

                }

                if ( !isdefined( _id_25A840A406E8542A ) || _id_E1CECB04682E8442.priority > _id_25A840A406E8542A.priority )
                    _id_25A840A406E8542A = _id_E1CECB04682E8442;
            }
        }

        if ( isdefined( _id_25A840A406E8542A ) )
            _id_420A996E67989DC4 _hudoutlineenableforclient( player, _id_25A840A406E8542A.hudoutlineassetname );
    }
}

outlinedisableinternalall( _id_420A996E67989DC4 )
{
    if ( !isdefined( _id_420A996E67989DC4 ) || !isdefined( _id_420A996E67989DC4.outlines ) || _id_420A996E67989DC4.outlines.size == 0 )
        return;

    foreach ( id, _ in _id_420A996E67989DC4.outlines )
        outlinedisableinternal( id, _id_420A996E67989DC4 );
}

outlineaddtogloballist( _id_420A996E67989DC4 )
{
    if ( !scripts\engine\utility::array_contains( level.outlineents, _id_420A996E67989DC4 ) )
        level.outlineents[level.outlineents.size] = _id_420A996E67989DC4;
}

outlineremovefromgloballist( _id_420A996E67989DC4 )
{
    level.outlineents = scripts\engine\utility::array_remove( level.outlineents, _id_420A996E67989DC4 );
}

outlinegethighestpriorityid( _id_420A996E67989DC4 )
{
    result = -1;

    if ( !isdefined( _id_420A996E67989DC4.outlines ) || _id_420A996E67989DC4.size == 0 )
        return result;

    _id_25A840A406E8542A = undefined;

    foreach ( id, _id_E1CECB04682E8442 in _id_420A996E67989DC4.outlines )
    {
        if ( !isdefined( _id_E1CECB04682E8442 ) || _id_E1CECB04682E8442.isdisabled )
            continue;

        if ( !isdefined( _id_25A840A406E8542A ) || _id_E1CECB04682E8442.priority > _id_25A840A406E8542A.priority )
        {
            _id_25A840A406E8542A = _id_E1CECB04682E8442;
            result = id;
        }
    }

    return result;
}

outlinegethighestinfoforplayer( _id_420A996E67989DC4, player )
{
    _id_25A840A406E8542A = undefined;

    if ( !isdefined( _id_420A996E67989DC4.outlines ) || _id_420A996E67989DC4.size == 0 )
        return _id_25A840A406E8542A;

    foreach ( id, _id_E1CECB04682E8442 in _id_420A996E67989DC4.outlines )
    {
        if ( !isdefined( _id_E1CECB04682E8442 ) || _id_E1CECB04682E8442.isdisabled )
            continue;

        if ( scripts\engine\utility::array_contains( _id_E1CECB04682E8442.playersvisibleto, player ) && ( !isdefined( _id_25A840A406E8542A ) || _id_E1CECB04682E8442.priority > _id_25A840A406E8542A.priority ) )
            _id_25A840A406E8542A = _id_E1CECB04682E8442;
    }

    return _id_25A840A406E8542A;
}

outlinegenerateuniqueid()
{
    level.outlineids++;
    return level.outlineids;
}

outlineprioritygroupmap( prioritygroup )
{
    prioritygroup = tolower( prioritygroup );
    priority = undefined;

    switch ( prioritygroup )
    {
        case "lowest":
            priority = 0;
            break;
        case "level_script":
            priority = 1;
            break;
        case "equipment":
            priority = 2;
            break;
        case "perk":
            priority = 3;
            break;
        case "perk_superior":
            priority = 4;
            break;
        case "killstreak":
            priority = 5;
            break;
        case "killstreak_personal":
            priority = 6;
            break;
        case "laststand":
            priority = 7;
            break;
        case "top":
            priority = 8;
            break;
        default:
            priority = 0;
            break;
    }

    return priority;
}

outlineiddowatch()
{
    foreach ( index, ent in level.outlineidspending )
    {
        if ( !isdefined( ent ) )
            continue;

        if ( !isdefined( ent.outlines ) )
            continue;

        _id_E1CECB04682E8442 = ent.outlines[index];

        if ( !isdefined( _id_E1CECB04682E8442 ) )
            continue;

        if ( _id_E1CECB04682E8442.playersvisibletopending.size > 0 )
        {
            if ( outlinerefreshpending( ent, index ) )
                level.outlineidspending[index] = undefined;
        }
    }
}

outlineidswatchpending()
{
    for (;;)
    {
        waittillframeend;
        outlineiddowatch();
        waitframe();
    }
}

outlinerefreshpending( _id_420A996E67989DC4, id )
{
    _id_E1CECB04682E8442 = _id_420A996E67989DC4.outlines[id];

    foreach ( index, player in _id_E1CECB04682E8442.playersvisibletopending )
    {
        if ( !isdefined( player ) )
            continue;

        if ( canoutlineforplayer( player ) )
        {
            _id_25A840A406E8542A = outlinegethighestinfoforplayer( _id_420A996E67989DC4, player );

            if ( isdefined( _id_25A840A406E8542A ) && _id_25A840A406E8542A.hudoutlineassetname != "invisible" )
                _id_420A996E67989DC4 hudoutlineenableforclient( player, _id_25A840A406E8542A.hudoutlineassetname );
            else
                _id_420A996E67989DC4 hudoutlinedisableforclient( player );

            _id_E1CECB04682E8442.playersvisibletopending[index] = undefined;
        }
    }

    _id_E1CECB04682E8442.playersvisibletopending = scripts\engine\utility::array_removeundefined( _id_E1CECB04682E8442.playersvisibletopending );

    if ( _id_E1CECB04682E8442.playersvisibletopending.size == 0 )
    {
        if ( _id_E1CECB04682E8442.isdisabled )
            _id_420A996E67989DC4.outlines[id] = undefined;

        if ( _id_420A996E67989DC4.outlines.size == 0 )
            outlineremovefromgloballist( _id_420A996E67989DC4 );

        return 1;
    }

    return 0;
}

canoutlineforplayer( player )
{
    return player.sessionstate != "spectator";
}

_hudoutlineenableforclient( _id_2C6CA80E296FED3A, hudoutlineassetname )
{
    if ( hudoutlineassetname == "invisible" )
        self hudoutlinedisableforclient( _id_2C6CA80E296FED3A );
    else
        self hudoutlineenableforclient( _id_2C6CA80E296FED3A, hudoutlineassetname );
}

_hudoutlineenableforclients( _id_B66F9E35E36435BB, hudoutlineassetname )
{
    if ( hudoutlineassetname == "invisible" )
        self hudoutlinedisableforclients( _id_B66F9E35E36435BB );
    else
        self hudoutlineenableforclients( _id_B66F9E35E36435BB, hudoutlineassetname );
}
